import{u as P,r as a,k as R,n as E,c as x,w as s,a as o,b as G,i as J,o as S,d as n,e as v,f as Y,g as L,h as z,t as C}from"./index-CDzqZl3V.js";const H={class:"d-flex flex-column gap-4 mt-6"},W={__name:"Create",setup(K){const F=G(),h=P(),N=J("notify"),V=a(null),m=a(!1),p=a(""),f=a(""),_=a(null),y=a(null),b=a(!1),c=a(!0),r=a(""),d=a(""),k=a([]),i={required:t=>!!t||"This field is required",positiveNumber:t=>t&&parseFloat(t)>=0||"Must be a positive number",positiveInteger:t=>t&&parseInt(t)>0||"Must be a positive integer"};function q(t){const e=t.getFullYear(),u=(t.getMonth()+1).toString().padStart(2,"0"),g=t.getDate().toString().padStart(2,"0");return`${e}-${u}-${g}`}const M=R(()=>({amount:p.value,duration_months:parseInt(f.value),start_at:q(_.value),loan_type:y.value})),U=async()=>{var t,e;if(m.value){b.value=!0,r.value="",d.value="";try{await h.fetchData("loans/",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(M.value)}),d.value="Loan added successfully!",N("Loan added successfully!"),T(),F.push("/customer"),window.location.reload()}catch(u){console.error(u),r.value=((e=(t=u.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to add loan"}finally{b.value=!1}}},T=()=>{p.value="",f.value="",_.value=null,y.value=null,r.value="",d.value||(d.value=""),V.value&&V.value.resetValidation()},I=async()=>{c.value=!0;try{const t=await h.fetchData("loans/type/",{headers:{"Content-Type":"application/json"},method:"GET"});k.value=t.results||[]}catch(t){console.error("Failed to fetch loan types:",t),r.value="Failed to load loan types. Please refresh the page."}finally{c.value=!1}};return E(()=>{I()}),(t,e)=>{const u=o("v-card-title"),g=o("v-text-field"),j=o("v-date-picker"),A=o("v-select"),w=o("v-alert"),D=o("v-btn"),B=o("v-form"),$=o("v-card-text"),O=o("v-card");return S(),x(O,{class:"mx-auto my-12","max-width":"500"},{default:s(()=>[n(u,{class:"text-h5 text-center py-4"},{default:s(()=>e[5]||(e[5]=[v(" Add Loan ")])),_:1}),n($,null,{default:s(()=>[n(B,{ref_key:"form",ref:V,modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=l=>m.value=l),onSubmit:Y(U,["prevent"])},{default:s(()=>[n(g,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=l=>p.value=l),label:"Loan Amount",type:"number",rules:[i.required,i.positiveNumber]},null,8,["modelValue","rules"]),n(g,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=l=>f.value=l),label:"Duration (Months)",type:"number",rules:[i.required,i.positiveInteger]},null,8,["modelValue","rules"]),n(j,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=l=>_.value=l),label:"Start Date",rules:[i.required],class:"mb-4"},null,8,["modelValue","rules"]),n(A,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=l=>y.value=l),items:k.value,"item-title":"name","item-value":"id",label:"Loan Type",rules:[i.required],loading:c.value,disabled:c.value},null,8,["modelValue","items","rules","loading","disabled"]),r.value?(S(),x(w,{key:0,type:"error",class:"mt-4"},{default:s(()=>[v(C(r.value),1)]),_:1})):L("",!0),d.value?(S(),x(w,{key:1,type:"success",class:"mt-4"},{default:s(()=>[v(C(d.value),1)]),_:1})):L("",!0),z("div",H,[n(D,{color:"primary",type:"submit",block:"",loading:b.value,disabled:!m.value||c.value},{default:s(()=>e[6]||(e[6]=[v(" Save Loan ")])),_:1},8,["loading","disabled"]),n(D,{color:"secondary",block:"",onClick:T,disabled:b.value},{default:s(()=>e[7]||(e[7]=[v(" Reset Form ")])),_:1},8,["disabled"])])]),_:1},8,["modelValue"])]),_:1})]),_:1})}}};export{W as default};
