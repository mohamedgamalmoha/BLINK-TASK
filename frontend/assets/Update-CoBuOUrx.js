import{u as O,k as U,q as z,r as o,n as H,c as f,w as l,i as K,a as s,b as Q,o as y,d as u,e as d,f as W,g as M,h as X,t as B}from"./index-CDzqZl3V.js";const Y={class:"d-flex flex-column gap-4 mt-6"},te={__name:"Update",setup(Z){const w=Q(),I=z(),V=O(),T=K("notify"),C=U(()=>I.params.id),x=o(null),_=o(!1),b=o(""),g=o(""),h=o(null),i=o(!1),F=o(!0),c=o(!0),n=o(""),v=o(""),S=o([]),m={required:t=>!!t||"This field is required",positiveNumber:t=>t&&parseFloat(t)>=0||"Must be a positive number",positiveInteger:t=>t&&parseInt(t)>0||"Must be a positive integer"},j=U(()=>({amount:b.value,duration_months:parseInt(g.value),loan_type:h.value})),E=async()=>{c.value=!0;try{const t=await V.fetchData("loans/fund-type/",{headers:{"Content-Type":"application/json"},method:"GET"});S.value=t.results||[]}catch(t){console.error("Failed to fetch fund types:",t),n.value="Failed to load fund types. Please refresh the page."}finally{c.value=!1}},D=async()=>{var t,e;F.value=!0,n.value="";try{const a=`loans/fund/${C.value}/`,p=await V.fetchData(a,{method:"GET"});b.value=p.amount.toString(),g.value=p.duration_months.toString(),h.value=p.loan_type}catch(a){console.error(a),n.value=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to fetch fund data",T("Failed to fetch fund data","error")}finally{F.value=!1}},R=async()=>{var t,e;if(_.value){i.value=!0,n.value="",v.value="";try{const a=`loans/fund/${C.value}/`;await V.fetchData(a,{headers:{"Content-Type":"application/json"},method:"PUT",body:JSON.stringify(j.value)}),v.value="Fund updated successfully!",T("Fund updated successfully!"),w.push("/provider"),window.location.reload()}catch(a){console.error(a),n.value=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to update fund"}finally{i.value=!1}}},A=()=>{D(),n.value="",v.value="",x.value&&x.value.resetValidation()},G=()=>{w.back()};return H(async()=>{await E(),await D()}),(t,e)=>{const a=s("v-card-title"),p=s("v-progress-circular"),N=s("v-text-field"),P=s("v-select"),q=s("v-alert"),k=s("v-btn"),$=s("v-form"),J=s("v-card-text"),L=s("v-card");return y(),f(L,{class:"mx-auto my-12","max-width":"500"},{default:l(()=>[u(a,{class:"text-h5 text-center py-4"},{default:l(()=>e[4]||(e[4]=[d(" Edit Fund ")])),_:1}),u(J,null,{default:l(()=>[F.value?(y(),f(p,{key:0,indeterminate:"",color:"primary",class:"d-flex mx-auto my-8"})):(y(),f($,{key:1,ref_key:"form",ref:x,modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=r=>_.value=r),onSubmit:W(R,["prevent"])},{default:l(()=>[u(N,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=r=>b.value=r),label:"Fund Amount",type:"number",rules:[m.required,m.positiveNumber]},null,8,["modelValue","rules"]),u(N,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=r=>g.value=r),label:"Duration (Months)",type:"number",rules:[m.required,m.positiveInteger]},null,8,["modelValue","rules"]),u(P,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=r=>h.value=r),items:S.value,"item-title":"name","item-value":"id",label:"Fund Type",rules:[m.required],loading:c.value,disabled:c.value},null,8,["modelValue","items","rules","loading","disabled"]),n.value?(y(),f(q,{key:0,type:"error",class:"mt-4"},{default:l(()=>[d(B(n.value),1)]),_:1})):M("",!0),v.value?(y(),f(q,{key:1,type:"success",class:"mt-4"},{default:l(()=>[d(B(v.value),1)]),_:1})):M("",!0),X("div",Y,[u(k,{color:"primary",type:"submit",block:"",loading:i.value,disabled:!_.value||c.value},{default:l(()=>e[5]||(e[5]=[d(" Save Changes ")])),_:1},8,["loading","disabled"]),u(k,{color:"secondary",block:"",onClick:A,disabled:i.value},{default:l(()=>e[6]||(e[6]=[d(" Reset Form ")])),_:1},8,["disabled"]),u(k,{color:"error",block:"",onClick:G,disabled:i.value},{default:l(()=>e[7]||(e[7]=[d(" Cancel ")])),_:1},8,["disabled"])])]),_:1},8,["modelValue"]))]),_:1})]),_:1})}}};export{te as default};
