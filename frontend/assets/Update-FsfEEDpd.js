import{u as z,k as D,q as H,r as l,n as K,c as y,w as r,i as Q,a as i,b as W,o as d,d as n,p as A,f as X,g as B,h as Y,e as b,t as E}from"./index-CDzqZl3V.js";const Z={key:0},ee={key:1},te={class:"d-flex flex-column gap-4 mt-6"},le={__name:"Update",setup(ae){const I=W(),T=H(),U=z(),w=Q("notify"),x=D(()=>T.params.id),M=l(null),V=l(!1),g=l(""),v=l(""),k=l(""),h=l(""),p=l(""),F=l(""),_=l(!1),S=l(!0),m=l(""),f=l(""),a={required:t=>!!t||"This field is required",positiveNumber:t=>t&&parseFloat(t)>=0||"Must be a positive number",positiveInteger:t=>t&&parseInt(t)>0||"Must be a positive integer",maxAmount:t=>!v.value||parseFloat(t)>=parseFloat(v.value)||"Maximum amount must be greater than minimum amount",maxDuration:t=>!p.value||parseInt(t)>=parseInt(p.value)||"Maximum duration must be greater than minimum duration"},R=D(()=>({name:g.value,min_amount:parseFloat(v.value),max_amount:parseFloat(k.value),interest_rate:parseFloat(h.value),min_duration_months:parseInt(p.value),max_duration_months:parseInt(F.value)})),q=D(()=>T.query.isFund==="true"),C=async()=>{var t,e;S.value=!0,m.value="";try{const u=q.value?`loans/fund-type/${x.value}/`:`loans/type/${x.value}/`,s=await U.fetchData(u,{method:"GET"});g.value=s.name,v.value=s.min_amount.toString(),k.value=s.max_amount.toString(),h.value=s.interest_rate.toString(),p.value=s.min_duration_months.toString(),F.value=s.max_duration_months.toString()}catch(u){console.error(u),m.value=((e=(t=u.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to fetch loan type data",w("Failed to fetch loan type data","error")}finally{S.value=!1}},$=async()=>{var t,e;if(V.value){_.value=!0,m.value="",f.value="";try{const u=q.value?`loans/fund-type/${x.value}/`:`loans/type/${x.value}/`;await U.fetchData(u,{headers:{"Content-Type":"application/json"},method:"PUT",body:JSON.stringify(R.value)}),f.value="Loan product updated successfully!",w("Loan product updated successfully!"),I.push("/personnel"),window.location.reload()}catch(u){console.error(u),m.value=((e=(t=u.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to update loan product"}finally{_.value=!1}}},j=()=>{C(),m.value="",f.value="",M.value&&M.value.resetValidation()},G=()=>{I.back()};return K(()=>{C()}),(t,e)=>{const u=i("v-card-title"),s=i("v-progress-circular"),c=i("v-text-field"),L=i("v-alert"),N=i("v-btn"),J=i("v-form"),O=i("v-card-text"),P=i("v-card");return d(),y(P,{class:"mx-auto my-12","max-width":"500"},{default:r(()=>[n(u,{class:"text-h5 text-center py-4"},{default:r(()=>[q.value?(d(),A("span",Z,"Edit Fund Type")):(d(),A("span",ee,"Edit Loan Type"))]),_:1}),n(O,null,{default:r(()=>[S.value?(d(),y(s,{key:0,indeterminate:"",color:"primary",class:"d-flex mx-auto my-8"})):(d(),y(J,{key:1,ref_key:"form",ref:M,modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=o=>V.value=o),onSubmit:X($,["prevent"])},{default:r(()=>[n(c,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=o=>g.value=o),label:"Loan Type Name",rules:[a.required]},null,8,["modelValue","rules"]),n(c,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=o=>v.value=o),label:"Minimum Amount",type:"number",rules:[a.required,a.positiveNumber]},null,8,["modelValue","rules"]),n(c,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=o=>k.value=o),label:"Maximum Amount",type:"number",rules:[a.required,a.positiveNumber,a.maxAmount]},null,8,["modelValue","rules"]),n(c,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=o=>h.value=o),label:"Interest Rate (%)",type:"number",step:"0.01",rules:[a.required,a.positiveNumber]},null,8,["modelValue","rules"]),n(c,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=o=>p.value=o),label:"Minimum Duration (Months)",type:"number",rules:[a.required,a.positiveInteger]},null,8,["modelValue","rules"]),n(c,{modelValue:F.value,"onUpdate:modelValue":e[5]||(e[5]=o=>F.value=o),label:"Maximum Duration (Months)",type:"number",rules:[a.required,a.positiveInteger,a.maxDuration]},null,8,["modelValue","rules"]),m.value?(d(),y(L,{key:0,type:"error",class:"mt-4"},{default:r(()=>[b(E(m.value),1)]),_:1})):B("",!0),f.value?(d(),y(L,{key:1,type:"success",class:"mt-4"},{default:r(()=>[b(E(f.value),1)]),_:1})):B("",!0),Y("div",te,[n(N,{color:"primary",type:"submit",block:"",loading:_.value,disabled:!V.value},{default:r(()=>e[7]||(e[7]=[b(" Save Changes ")])),_:1},8,["loading","disabled"]),n(N,{color:"secondary",block:"",onClick:j,disabled:_.value},{default:r(()=>e[8]||(e[8]=[b(" Reset Form ")])),_:1},8,["disabled"]),n(N,{color:"error",block:"",onClick:G,disabled:_.value},{default:r(()=>e[9]||(e[9]=[b(" Cancel ")])),_:1},8,["disabled"])])]),_:1},8,["modelValue"]))]),_:1})]),_:1})}}};export{le as default};
