import{q as J,u as Y,r as a,k as H,n as K,c as V,w as r,a as l,b as Q,i as W,o as x,d as n,e as g,g as S,f as X,h as Z,t as q}from"./index-CDzqZl3V.js";const ee={class:"d-flex flex-column gap-4 mt-6"},oe={__name:"Update",setup(te){const C=Q(),w=J().params.id,D=Y(),M=W("notify"),T=a(null),b=a(!1),v=a(""),m=a(""),i=a(null),p=a(null),h=a(!1),k=a(!0),f=a(!0),u=a(""),_=a(""),N=a([]),d=a(null),c={required:e=>!!e||"This field is required",positiveNumber:e=>e&&parseFloat(e)>=0||"Must be a positive number",positiveInteger:e=>e&&parseInt(e)>0||"Must be a positive integer"};function E(e){if(!e)return null;if(typeof e=="string"){const y=new Date(e);if(isNaN(y.getTime()))return null;e=y}const t=e.getFullYear(),s=(e.getMonth()+1).toString().padStart(2,"0"),L=e.getDate().toString().padStart(2,"0");return`${t}-${s}-${L}`}const I=H(()=>({amount:v.value,duration_months:parseInt(m.value),start_at:E(i.value),loan_type:p.value})),$=async()=>{var e,t;if(b.value){h.value=!0,u.value="",_.value="";try{const s=`loans/${w}/`;await D.fetchData(s,{headers:{"Content-Type":"application/json"},method:"PUT",body:JSON.stringify(I.value)}),_.value="Loan updated successfully!",M("Loan updated successfully!"),setTimeout(()=>{C.push("/customer")},1500)}catch(s){console.error(s),u.value=((t=(e=s.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to update loan"}finally{h.value=!1}}},j=()=>{d.value&&(v.value=d.value.amount||"",m.value=d.value.duration_months||"",i.value=d.value.start_at||null,p.value=d.value.loan_type||null),u.value="",_.value="",T.value&&T.value.resetValidation()},P=async()=>{k.value=!0;try{const e=await D.fetchData(`loans/${w}/`,{headers:{"Content-Type":"application/json"},method:"GET"});if(d.value={...e},v.value=e.amount||"",m.value=e.duration_months||"",e.start_at)try{i.value=new Date(e.start_at)}catch(t){console.error("Error parsing date:",t),i.value=null}p.value=e.loan_type||null}catch(e){console.error("Failed to fetch loan data:",e),u.value="Failed to load loan data. Please try again."}finally{k.value=!1}},B=async()=>{f.value=!0;try{const e=await D.fetchData("loans/type/",{headers:{"Content-Type":"application/json"},method:"GET"});N.value=e.results||[]}catch(e){console.error("Failed to fetch loan types:",e),u.value="Failed to load loan types. Please refresh the page."}finally{f.value=!1}};return K(()=>{Promise.all([B(),P()]).catch(e=>{console.error("Error during initialization:",e)})}),(e,t)=>{const s=l("v-card-title"),L=l("v-progress-circular"),y=l("v-text-field"),R=l("v-date-picker"),A=l("v-select"),F=l("v-alert"),U=l("v-btn"),G=l("v-form"),O=l("v-card-text"),z=l("v-card");return x(),V(z,{class:"mx-auto my-12","max-width":"500"},{default:r(()=>[n(s,{class:"text-h5 text-center py-4"},{default:r(()=>t[5]||(t[5]=[g(" Edit Loan ")])),_:1}),n(O,null,{default:r(()=>[k.value?(x(),V(L,{key:0,indeterminate:"",color:"primary",class:"d-flex mx-auto my-8"})):S("",!0),n(G,{ref_key:"form",ref:T,modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=o=>b.value=o),onSubmit:X($,["prevent"])},{default:r(()=>[n(y,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=o=>v.value=o),label:"Loan Amount",type:"number",rules:[c.required,c.positiveNumber]},null,8,["modelValue","rules"]),n(y,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=o=>m.value=o),label:"Duration (Months)",type:"number",rules:[c.required,c.positiveInteger]},null,8,["modelValue","rules"]),n(R,{modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=o=>i.value=o),label:"Start Date",rules:[c.required],class:"mb-4"},null,8,["modelValue","rules"]),n(A,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=o=>p.value=o),items:N.value,"item-title":"name","item-value":"id",label:"Loan Type",rules:[c.required],loading:f.value,disabled:f.value},null,8,["modelValue","items","rules","loading","disabled"]),u.value?(x(),V(F,{key:0,type:"error",class:"mt-4"},{default:r(()=>[g(q(u.value),1)]),_:1})):S("",!0),_.value?(x(),V(F,{key:1,type:"success",class:"mt-4"},{default:r(()=>[g(q(_.value),1)]),_:1})):S("",!0),Z("div",ee,[n(U,{color:"primary",type:"submit",block:"",loading:h.value,disabled:!b.value||f.value},{default:r(()=>t[6]||(t[6]=[g(" Update Loan ")])),_:1},8,["loading","disabled"]),n(U,{color:"secondary",block:"",onClick:j,disabled:h.value},{default:r(()=>t[7]||(t[7]=[g(" Reset to Original ")])),_:1},8,["disabled"])])]),_:1},8,["modelValue"])]),_:1})]),_:1})}}};export{oe as default};
