import{u as F,r as I,n as N,p as v,d as a,w as e,a as d,o as f,h as l,e as i,g as U,F as A,s as M,t as s}from"./index-CDzqZl3V.js";const P={key:0,class:"text-center py-5"},V={__name:"List",setup(j){const y=F(),c=I([]),D=[{text:"#",value:"payment_number",width:"5%"},{text:"Payment Date",value:"payment_date",width:"15%"},{text:"Principal",value:"principal_amount",width:"15%"},{text:"Interest",value:"interest_amount",width:"15%"},{text:"Total Payment",value:"total_payment",width:"15%"},{text:"Remaining Balance",value:"remaining_balance",width:"20%"},{text:"Status",value:"is_paid",width:"15%"}],C=n=>({0:"grey",1:"green",2:"red",3:"blue",4:"green"})[n]||"grey",S=n=>({0:"Pending",1:"Approved",2:"Rejected",3:"Active",4:"Completed"})[n]||"Unknown",m=n=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n),g=n=>{if(!n)return"";const t=new Date(n);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(t)},x=async()=>{try{const n=await y.fetchData("loans/?expand=amortizations",{headers:{"Content-Type":"application/json"},method:"GET"});console.log(n),c.value=n.results||[],c.value.forEach(t=>{t.amortizations&&t.amortizations.sort((u,p)=>parseInt(u.payment_number)-parseInt(p.payment_number))})}catch(n){console.error("Failed to fetch loans:",n)}},k=async n=>{try{await y.fetchData(`loans/${n}/`,{headers:{"Content-Type":"application/json"},method:"DELETE"}),await x()}catch(t){console.error("Failed to delete loan:",t)}};return N(()=>{x()}),(n,t)=>{const u=d("v-btn"),p=d("v-card-title"),w=d("v-chip"),T=d("v-spacer"),_=d("v-col"),E=d("v-row"),L=d("v-divider"),z=d("v-data-table"),b=d("v-card-text"),h=d("v-card");return f(),v("div",null,[a(h,null,{default:e(()=>[a(p,{class:"d-flex justify-space-between align-center"},{default:e(()=>[t[1]||(t[1]=l("span",null,"User Loans",-1)),a(u,{to:{name:"customer-create"},text:""},{default:e(()=>t[0]||(t[0]=[i(" Create ")])),_:1})]),_:1}),a(b,null,{default:e(()=>[(f(!0),v(A,null,M(c.value,r=>(f(),v("div",{key:r.id,class:"mb-8"},[a(h,{outlined:""},{default:e(()=>[a(p,{class:"subtitle-1 font-weight-bold"},{default:e(()=>[i(" Loan #"+s(r.id)+" ",1),a(w,{color:C(r.status),dark:"",class:"ml-4"},{default:e(()=>[i(s(S(r.status)),1)]),_:2},1032,["color"]),a(T),a(u,{small:"",to:{name:"customer-edit",params:{id:r.id}},class:"mr-2"},{default:e(()=>t[2]||(t[2]=[i(" Edit ")])),_:2},1032,["to"]),a(u,{small:"",onClick:o=>k(r.id),color:"red"},{default:e(()=>t[3]||(t[3]=[i(" Delete ")])),_:2},1032,["onClick"])]),_:2},1024),a(b,null,{default:e(()=>[a(E,null,{default:e(()=>[a(_,{cols:"12",sm:"6",md:"3"},{default:e(()=>[t[4]||(t[4]=l("div",{class:"caption grey--text"},"Amount",-1)),l("div",null,s(m(r.amount)),1)]),_:2},1024),a(_,{cols:"12",sm:"6",md:"3"},{default:e(()=>[t[5]||(t[5]=l("div",{class:"caption grey--text"},"Duration",-1)),l("div",null,s(r.duration_months)+" months",1)]),_:2},1024),a(_,{cols:"12",sm:"6",md:"3"},{default:e(()=>[t[6]||(t[6]=l("div",{class:"caption grey--text"},"Start Date",-1)),l("div",null,s(g(r.start_at)),1)]),_:2},1024),a(_,{cols:"12",sm:"6",md:"3"},{default:e(()=>[t[7]||(t[7]=l("div",{class:"caption grey--text"},"Customer ID",-1)),l("div",null,s(r.customer),1)]),_:2},1024)]),_:2},1024),a(L,{class:"my-4"}),t[8]||(t[8]=l("div",{class:"subtitle-1 font-weight-bold mb-3"},"Amortization Schedule",-1)),a(z,{headers:D,items:r.amortizations||[],dense:"","hide-default-footer":"",class:"elevation-1","items-per-page":10},{"item.payment_date":e(({item:o})=>[i(s(g(o.payment_date)),1)]),"item.principal_amount":e(({item:o})=>[i(s(m(o.principal_amount)),1)]),"item.interest_amount":e(({item:o})=>[i(s(m(o.interest_amount)),1)]),"item.total_payment":e(({item:o})=>[i(s(m(o.total_payment)),1)]),"item.remaining_balance":e(({item:o})=>[i(s(m(o.remaining_balance)),1)]),"item.is_paid":e(({item:o})=>[a(w,{color:o.is_paid?"green":"grey",small:"",dark:""},{default:e(()=>[i(s(o.is_paid?"Paid":"Unpaid"),1)]),_:2},1032,["color"])]),_:2},1032,["items"])]),_:2},1024)]),_:2},1024)]))),128)),c.value.length===0?(f(),v("div",P,t[9]||(t[9]=[l("p",null,"No loans found",-1)]))):U("",!0)]),_:1})]),_:1})])}}};export{V as default};
