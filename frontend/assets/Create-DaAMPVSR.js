import{u as O,r as a,k as P,n as R,c as V,w as l,a as o,b as E,i as G,o as g,d as s,e as c,f as J,g as S,h as z,t as C}from"./index-CDzqZl3V.js";const H={class:"d-flex flex-column gap-4 mt-6"},Q={__name:"Create",setup(K){const N=E(),x=O(),q=G("notify"),b=a(null),m=a(!1),p=a(""),f=a(""),y=a(null),_=a(!1),d=a(!0),u=a(""),r=a(""),F=a([]),i={required:t=>!!t||"This field is required",positiveNumber:t=>t&&parseFloat(t)>=0||"Must be a positive number",positiveInteger:t=>t&&parseInt(t)>0||"Must be a positive integer"},D=P(()=>({amount:p.value,duration_months:parseInt(f.value),loan_type:y.value})),M=async()=>{var t,e;if(m.value){_.value=!0,u.value="",r.value="";try{await x.fetchData("loans/fund/",{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(D.value)}),r.value="Fund added successfully!",q("Fund added successfully!"),h(),N.push("/provider"),window.location.reload()}catch(v){console.error(v),u.value=((e=(t=v.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to add fund"}finally{_.value=!1}}},h=()=>{p.value="",f.value="",y.value=null,u.value="",r.value||(r.value=""),b.value&&b.value.resetValidation()},I=async()=>{d.value=!0;try{const t=await x.fetchData("loans/fund-type/",{headers:{"Content-Type":"application/json"},method:"GET"});F.value=t.results||[]}catch(t){console.error("Failed to fetch fund types:",t),u.value="Failed to load fund types. Please refresh the page."}finally{d.value=!1}};return R(()=>{I()}),(t,e)=>{const v=o("v-card-title"),T=o("v-text-field"),U=o("v-select"),k=o("v-alert"),w=o("v-btn"),j=o("v-form"),A=o("v-card-text"),B=o("v-card");return g(),V(B,{class:"mx-auto my-12","max-width":"500"},{default:l(()=>[s(v,{class:"text-h5 text-center py-4"},{default:l(()=>e[4]||(e[4]=[c(" Add Fund ")])),_:1}),s(A,null,{default:l(()=>[s(j,{ref_key:"form",ref:b,modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=n=>m.value=n),onSubmit:J(M,["prevent"])},{default:l(()=>[s(T,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=n=>p.value=n),label:"Fund Amount",type:"number",rules:[i.required,i.positiveNumber]},null,8,["modelValue","rules"]),s(T,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=n=>f.value=n),label:"Duration (Months)",type:"number",rules:[i.required,i.positiveInteger]},null,8,["modelValue","rules"]),s(U,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=n=>y.value=n),items:F.value,"item-title":"name","item-value":"id",label:"Fund Type",rules:[i.required],loading:d.value,disabled:d.value},null,8,["modelValue","items","rules","loading","disabled"]),u.value?(g(),V(k,{key:0,type:"error",class:"mt-4"},{default:l(()=>[c(C(u.value),1)]),_:1})):S("",!0),r.value?(g(),V(k,{key:1,type:"success",class:"mt-4"},{default:l(()=>[c(C(r.value),1)]),_:1})):S("",!0),z("div",H,[s(w,{color:"primary",type:"submit",block:"",loading:_.value,disabled:!m.value||d.value},{default:l(()=>e[5]||(e[5]=[c(" Save Fund ")])),_:1},8,["loading","disabled"]),s(w,{color:"secondary",block:"",onClick:h,disabled:_.value},{default:l(()=>e[6]||(e[6]=[c(" Reset Form ")])),_:1},8,["disabled"])])]),_:1},8,["modelValue"])]),_:1})]),_:1})}}};export{Q as default};
